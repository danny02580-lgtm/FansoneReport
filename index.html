<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fansone Report</title>
<script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>
<style>
  :root{
    --bg0:#0b1220; --bg1:#0f1a2e; --panel:rgba(255,255,255,.06); --stroke:rgba(255,255,255,.14);
    --text:#e5e7eb; --muted:#9ca3af;
    --new:#3498db; --old:#2980b9;
    --rev:#e74c3c; --single:#a78bfa; --totalrev:#f59e0b;
    --arpu:#d35400;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 20% 10%, rgba(52,152,219,.18), transparent 60%),
      radial-gradient(900px 500px at 85% 25%, rgba(231,76,60,.16), transparent 60%),
      radial-gradient(800px 500px at 60% 90%, rgba(245,158,11,.14), transparent 60%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    min-height:100vh;
  }
  a{color:inherit; text-decoration:none}
  .wrap{max-width:1200px; margin:0 auto; padding:20px 16px 36px}
  .topbar{
    display:flex; align-items:flex-start; justify-content:space-between; gap:14px;
    padding:14px; border:1px solid var(--stroke); border-radius:16px; background:var(--panel); backdrop-filter: blur(10px);
  }
  .title h1{margin:0; font-size:18px}
  .title .sub{margin-top:6px; font-size:12px; color:var(--muted); line-height:1.4}
  #status.ok{color:#34d399}
  #status.err{color:#fb7185}
  .kpis{display:flex; flex-wrap:wrap; gap:10px; justify-content:flex-end; align-items:stretch}
  .kpi{
    padding:12px 14px; border:1px solid var(--stroke); border-radius:16px; background:rgba(255,255,255,.04);
    min-width:220px; display:flex; flex-direction:column; gap:6px;
  }
  .kpi .klabel{font-size:12px; color:var(--muted)}
  .kpi .kvalue{font-size:24px; font-weight:850; letter-spacing:.2px; color:var(--text)}
  .kpi.small{min-width:140px}
  .kpi.small .kvalue{font-size:24px}

  .grid{display:grid; grid-template-columns: 360px 1fr; gap:14px; margin-top:14px}
  @media (max-width: 980px){ .grid{grid-template-columns: 1fr} }
  .panel{border:1px solid var(--stroke); border-radius:16px; background:var(--panel); backdrop-filter: blur(10px); overflow:hidden}
  .hd{padding:12px; border-bottom:1px solid rgba(255,255,255,.10); display:flex; align-items:center; justify-content:space-between; gap:10px}
  .hd h2{margin:0; font-size:13px}
  .bd{padding:12px}

  .select{
    width:100%;
    padding:12px 12px;
    border:1px solid var(--stroke);
    border-radius:14px;
    background:rgba(255,255,255,.04);
    color:var(--text);
    font-size:13px;
    outline:none;
  }
  .hint{margin-top:8px; font-size:11px; color:var(--muted); line-height:1.45}

  .checks{display:grid; grid-template-columns: 1fr; gap:8px; margin-top:10px}
  .check{
    display:flex; gap:10px; align-items:center;
    padding:10px 10px;
    border:1px solid var(--stroke);
    border-radius:14px;
    background:rgba(255,255,255,.03);
  }
  .check input{width:18px; height:18px; accent-color: var(--new)}
  .dot{width:10px; height:10px; border-radius:999px; background:#fff; box-shadow:0 0 0 3px rgba(255,255,255,.07)}
  .label{display:flex; flex-direction:column; gap:2px}
  .label b{font-size:12px; font-weight:750}
  .label span{font-size:11px; color:var(--muted)}

  #chart{width:100%; height:560px}
  @media (max-width: 980px){ #chart{height:520px} }

  .tablesGrid{display:grid; grid-template-columns: 1.3fr 1fr; gap:14px; margin-top:14px}
  @media (max-width: 980px){ .tablesGrid{grid-template-columns: 1fr} }
  table{width:100%; border-collapse:separate; border-spacing:0; font-size:12px}
  th,td{padding:10px 10px; border-bottom:1px solid rgba(255,255,255,.08)}
  th{text-align:left; color:var(--muted); font-weight:700; background:rgba(255,255,255,.03); position:sticky; top:0; backdrop-filter: blur(10px)}
  td.right, th.right{text-align:right}
  tr:hover td{background:rgba(255,255,255,.03)}
  .sheetlink{color: var(--muted); border:1px solid var(--stroke); padding:7px 9px; border-radius:999px; background:rgba(255,255,255,.04)}
  .sheetlink:hover{color:var(--text)}
  .pill{padding:5px 8px; border:1px solid var(--stroke); border-radius:999px; font-size:11px; color:var(--muted); background:rgba(255,255,255,.03)}

/* --- Mobile polish (no layout break) --- */
@media (max-width: 860px){
  .wrap{padding:12px;}
  .hd{flex-direction:column; align-items:flex-start; gap:10px;}
  .kpis{grid-template-columns:1fr 1fr; gap:10px;}
  .kpi .big{font-size:22px;}
  .kpi .sub{font-size:12px;}
  .content{grid-template-columns:1fr; gap:12px;}
  #chart{height:360px !important;}
  .panel{border-radius:14px;}
  .controls{position:sticky; top:0; z-index:5;}
  .checks{max-height:none;}
  table{font-size:12px;}
  .tableWrap{overflow:auto; -webkit-overflow-scrolling:touch;}
}
@media (max-width: 480px){
  .kpis{grid-template-columns:1fr; }
  #chart{height:320px !important;}
  .btn, select, input[type="checkbox"]{touch-action:manipulation;}
}


/* === KPI premium cards (A) === */
.kpis{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px;margin:12px 0 14px;}
.kpi{background:linear-gradient(135deg,rgba(255,255,255,.08),rgba(255,255,255,.03));border:1px solid rgba(255,255,255,.14);
     border-radius:16px;padding:14px 14px;box-shadow:0 14px 34px rgba(0,0,0,.22);}
.kpi .klabel{font-size:12px;color:rgba(255,255,255,.70);letter-spacing:.12em;}
.kpi .kvalue{margin-top:6px;font-size:32px;font-weight:850;letter-spacing:.02em;}
@media(max-width:520px){.kpis{grid-template-columns:1fr;}.kpi .kvalue{font-size:28px;}}


/* === Segmented control (B) === */
.segmented{display:flex;gap:6px;padding:6px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.14);border-radius:14px;
           overflow-x:auto;-webkit-overflow-scrolling:touch;margin:10px 0 10px;}
.segmented::-webkit-scrollbar{height:0}
.seg-btn{flex:1 0 auto;padding:10px 12px;border-radius:12px;border:0;background:transparent;color:rgba(255,255,255,.72);font-weight:750;cursor:pointer;white-space:nowrap;}
.seg-btn.active{background:rgba(255,255,255,.12);color:rgba(255,255,255,.96);}
.select.hidden{display:none!important;}


/* --- Requested UX patches (v3_8 based) --- */
#orderTag{display:none !important;}
.twoline{display:inline-block; line-height:1.05; text-align:center;}
@media (max-width:720px){
  .twoline{font-size:12px;}
}
.kprev{margin-top:6px; font-size:12px; opacity:.85;}


/* Map user insights buttons to segmented style without triggering chart view handlers */
.userseg .userseg-btn{ all:unset; cursor:pointer; padding:10px 12px; border-radius:999px; font-weight:600; letter-spacing:.2px; }
.userseg .userseg-btn.active{ background:rgba(255,255,255,.12); box-shadow:inset 0 0 0 1px rgba(255,255,255,.14); }


/* Hide legacy Prev label */
#prevTotalRevenue{display:none !important;}


/* Match Latest KPI typography to Total Revenue */
.kpi-card[data-kpi="latest"] .kpi-title,
#kpiLatest .kpi-title, #latestKpi .kpi-title, #kpiLatestTitle, #latestKpiTitle{
  font-size: inherit;
}
.kpi-card[data-kpi="latest"] .kpi-value,
#kpiLatest .kpi-value, #latestKpi .kpi-value, #kpiLatestValue, #latestKpiValue{
  font-size: inherit;
  font-weight: inherit;
}


/* Monthly table header: single line + alignment */
#monthlyTable thead th{white-space:nowrap !important; vertical-align:middle !important;}
#monthlyTable thead th:first-child, #monthlyTable tbody td:first-child{white-space:nowrap !important; text-align:left !important;}
#monthlyTable thead th.right, #monthlyTable tbody td.right{text-align:right !important;}

</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <div class="title">
      <h1>Fansone Report</h1>
      <div class="sub" id="status">Loading…</div>
    </div>
    <div class="kpis">
      <div class="kpi small">
        <div class="klabel">Latest</div>
        <div class="kvalue" id="months">–</div>
      </div>
      <div class="kpi">
        <div class="klabel">Total revenue</div>
        <div class="kvalue" id="totalRevenue">–</div></div>
    </div>
  </div>

  <div class="grid">
    <div class="panel">
      <div class="hd"><h2>圖表切換</h2><span class="pill" id="orderTag">新 → 舊</span></div>
      <div class="bd">
        
<div class="segmented" role="tablist" aria-label="Chart views">
  <button class="seg-btn active" type="button" data-value="money">Revenue</button>
  <button class="seg-btn" type="button" data-value="subs">Subscribers</button>
  <button class="seg-btn" type="button" data-value="mix">Plans</button>
  <button class="seg-btn" type="button" data-value="arpu">ARPU</button>
</div>

<select id="viewSelect" class="select hidden">
          <option value="money">金額（總/訂閱/單片）</option>
          <option value="subs">訂閱人數（新/舊柱狀）</option>
          <option value="mix">方案比例（1/3/6M 勾選）</option>
          <option value="arpu">ARPU（折線）</option>
        </select>
<div class="checks" id="checks"></div>
      </div>
    </div>

    <div class="panel" style="padding:10px">
      <div id="chart"></div>
    </div>
  </div>

  <div class="tablesGrid">
    <div class="panel">
      <div class="hd">
        <div style="display:flex; align-items:center; gap:10px;">
          <h2 style="margin:0;">月度總表</h2><span class="pill">訂閱 + 單片合計</span>
        </div>
      </div>
      <div class="bd" style="padding:0 0 10px 0;">
        <div style="max-height:340px; overflow:auto;">
          <table id="monthlyTable">
            <thead>
              <tr>
                <th>月份</th>
                <th class="right">訂閱人數</th>
                <th class="right">新客</th>
                <th class="right">舊客</th>
                <th class="right">訂閱營收</th>
                <th class="right">單片營收</th>
                <th class="right">總營收</th>
                <th class="right">ARPU</th>
              </tr>
            </thead>
            <tbody id="tbodyMonthly"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="hd">
        <div style="display:flex; align-items:center; gap:10px;">
          <h2 style="margin:0;">用戶分析</h2><span class="pill">Top 10</span>
        </div>
        <div class="segmented userseg" role="tablist" aria-label="User insights metric">
  <button class="userseg-btn active" type="button" data-metric="spend_total">付最多錢</button>
  <button class="userseg-btn" type="button" data-metric="active_months">訂閱最久</button>
</div>
<select id="userMetric" style="display:none" class="select" style="max-width:220px; padding:8px 10px;">
<option value="spend_total">付最多錢（總）</option>
<option value="active_months">訂閱最久（活躍月數）</option>

          
          
          
          
          
          
        </select>
      </div>
      <div class="bd" style="padding:0 0 10px 0;">
        <div style="max-height:340px; overflow:auto;">
          <table>
            <thead>
              <tr>
                <th>User ID</th>
                <th class="right">指標</th>
                <th class="right">訂閱$</th>
                <th class="right">單片$</th>
                <th class="right">總$</th>
              </tr>
            </thead>
            <tbody id="tbodyUsers"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="tablesGrid" style="grid-template-columns: 1fr; margin-top:14px;">
    <div class="panel">
      <div class="hd">
        <div style="display:flex; align-items:center; gap:10px;">
          <h2 style="margin:0;">單片 TOP10</h2><span class="pill">點標題可直達貼文</span>
        </div>
</div>
      <div class="bd" style="padding:0 0 10px 0;">
        <div style="max-height:320px; overflow:auto;">
          <table>
            <thead>
              <tr>
                <th>影片標題</th>
                <th class="right">金額</th>
                <th class="right">筆數</th>
              </tr>
            </thead>
            <tbody id="tbodySingles"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>

// Ensure Latest KPI uses same emphasis class as Total Revenue
(function(){
  function syncKpiStyles(){
    const totalCard = document.querySelector('.kpi-card[data-kpi="total"], #kpiTotal, #totalKpi, [data-kpi="totalRevenue"]');
    const latestCard = document.querySelector('.kpi-card[data-kpi="latest"], #kpiLatest, #latestKpi, [data-kpi="latestRevenue"]');
    if(totalCard && latestCard){
      // copy key classes if present
      ["kpi-primary","kpi-big","primary","big"].forEach(cls=>{
        if(totalCard.classList.contains(cls)) latestCard.classList.add(cls);
      });
    }
  }
  setTimeout(syncKpiStyles, 0);
  setTimeout(syncKpiStyles, 300);
})();

</script>

</body>
</html>
